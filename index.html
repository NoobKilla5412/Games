<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Noob Killa's OS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <style>
    body {
      margin: 0px;
    }

    #container {
      width: 98%;
      /* margin: 0px; */
      margin: 1%;
    }

    .container-fluid,
    #game {
      margin: 0px;
      padding: 0px;
    }

    #homeBar {
      padding: 1%;
      position: absolute;
      bottom: 0px;
      width: 100%;
      background: #cccccc;
      margin: 0px;
      text-align: center;
    }

    img {
      width: 75px;
      height: 75px;
      border-radius: .5rem;
      background-color: black;
      cursor: pointer;
    }

    iframe {
      width: 100%;
      left: 0px;
      right: 0px;
      height: calc(100vh - 62px);
    }

    div.app {
      display: inline-block;
      text-align: center;
      width: 141.203px;
    }

    button {
      border-width: 2px;
      border-style: outset;
      border-color: buttonborder;
      border-image: initial;
      border-radius: .5rem;
    }

    .show {
      z-index: 1000;
      position: absolute;
      background-color: #C0C0C0;
      border: 1px solid blue;
      padding: 2px;
      display: block;
      margin: 0;
      list-style-type: none;
      list-style: none;
    }

    .hide {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div id="container"></div>
    <div id="game"></div>
  </div>
  <div id="homeBar">
    <button onclick="home();">Home</button>
  </div>
  <div id="r-click-div"></div>
  <script src="apps.js"></script>
  <script>
    let activeApp;
    let appLibrary = {};
    if (!localStorage.getItem('apps')) {
      localStorage.setItem('apps', JSON.stringify(appLibrary));
    } else {
      appLibrary = JSON.parse(localStorage.getItem('apps'));
    }
    for (const game in games) {
      if (Object.hasOwnProperty.call(games, game)) {
        const value = games[game];
        if (appLibrary[value.title]) {
          document.getElementById('container').innerHTML += `
<br style="display:none" id="${game}Br" />
<div class="app">
  <img src="${value.image}" id="${game}" /><br>
  <caption>
    ${value.title} ${value.version ? 'v' + value.version : ''}
  </caption>
</div>`;
          document.getElementById('r-click-div').innerHTML += `
<div class="hide" id="rmenu-${game}">
  <button id="delete-${game}">Delete</button>
</div>`;
        }
      }
    }
    for (const app in defaultApps) {
      if (Object.hasOwnProperty.call(defaultApps, app)) {
        const value = defaultApps[app];
        document.getElementById('container').innerHTML += `
<br style="display:none" id="${app}Br" />
<div class="app">
  <img src="${value.image}" id="${app}" ><br>
  <caption>
    ${value.title} ${value.version ? 'v' + value.version : ''}
  </caption>
</div>`;
      }
    }
    for (const app in apps) {
      if (Object.hasOwnProperty.call(apps, app)) {
        const value = apps[app];
        if (appLibrary[value.title]) {
          document.getElementById('container').innerHTML += `
<br style="display:none" id="${app}Br" />
<div class="app">
  <img src="${value.image}" id="${app}" ><br>
  <caption>
    ${value.title} ${value.version ? 'v' + value.version : ''}
  </caption>
</div>`;
          document.getElementById('r-click-div').innerHTML += `
<div class="hide" id="rmenu-${app}">
  <button id="delete-${app}">Delete</button>
</div>`;
        }
      }
    }

    for (const game in games) {
      if (Object.hasOwnProperty.call(games, game)) {
        const value = games[game];
        if (!value.link)
          value.link = `games/${value.title}/Launch.html`;

        if (appLibrary[value.title]) {
          document.getElementById(game).onclick = () => load(value);
          document.getElementById('delete-' + game).onclick = () => deleteGame(value);
        }
      }
    }

    for (const app in defaultApps) {
      if (Object.hasOwnProperty.call(defaultApps, app)) {
        const value = defaultApps[app];
        document.getElementById(app).onclick = () => load(value);
      }
    }
    for (const app in apps) {
      if (Object.hasOwnProperty.call(apps, app)) {
        const value = apps[app];
        if (appLibrary[value.title]) {
          document.getElementById(app).onclick = () => load(value);
          document.getElementById('delete-' + app).onclick = () => deleteGame(value, 'app');
        }
      }
    }

    // githubBr.style.display = 'initial';
    updateBr.style.display = 'initial';

    function load(game) {
      if (game.title == 'Update') {
        location.reload();
      } else {
        document.getElementById('game').innerHTML = `<iframe src="${game.link}" />`;
        document.getElementById('container').style.display = 'none';
        document.title = `${game.title} ${game.version ? 'v' + game.version : ''}`;
        activeApp = game.title;
      }
    }

    function deleteGame(game, type = 'game') {
      if (confirm(`Are you sure you want to delete ${game.title}?`)) {
        appLibrary[game.title] = false;
        localStorage.setItem('apps', JSON.stringify(appLibrary));
        if (type == 'game') {
          if (!confirm(`Do you want to keep save data for ${game.title}? Ok for save, Cancel for delete`)) {
            localStorage.removeItem(game.id);
          }
        }
        location.reload();
      }
    }

    function home() {
      if (activeApp != 'App Store') {
        document.getElementById('game').innerHTML = '';
        document.getElementById('container').style.display = 'block';
      } else {
        location.reload();
      }
      document.title = 'Games';
    }

    for (const game in games) {
      if (Object.hasOwnProperty.call(games, game)) {
        const value = games[game];
        if (appLibrary[value.title]) {
          document.getElementById(game).addEventListener('contextmenu', (e) => {
            e.preventDefault();
            document.getElementById(`rmenu-${game}`).className = 'show';
            document.getElementById(`rmenu-${game}`).style.top = mouseY(event) + 'px';
            document.getElementById(`rmenu-${game}`).style.left = mouseX(event) + 'px';
          });
        }
      }
    }
    for (const app in apps) {
      if (Object.hasOwnProperty.call(apps, app)) {
        const value = apps[app];
        if (appLibrary[value.title]) {
          document.getElementById(app).addEventListener('contextmenu', (e) => {
            e.preventDefault();
            document.getElementById(`rmenu-${app}`).className = 'show';
            document.getElementById(`rmenu-${app}`).style.top = mouseY(event) + 'px';
            document.getElementById(`rmenu-${app}`).style.left = mouseX(event) + 'px';
          });
        }
      }
    }
    for (const app in defaultApps) {
      if (Object.hasOwnProperty.call(defaultApps, app)) {
        const value = defaultApps[app];
        document.getElementById(app).addEventListener('contextmenu', (e) => {
          e.preventDefault();
        });
      }
    }

    window.addEventListener('click', (e) => {
      for (const game in games) {
        if (Object.hasOwnProperty.call(games, game)) {
          const value = games[game];
          if (appLibrary[value.title])
            document.getElementById(`rmenu-${game}`).className = 'hide';
        }
      }
      for (const app in apps) {
        if (Object.hasOwnProperty.call(apps, app)) {
          const value = apps[app];
          if (appLibrary[value.title])
            document.getElementById(`rmenu-${app}`).className = 'hide';
        }
      }
    });

    function mouseX(e) {
      if (e.pageX) {
        return e.pageX;
      } else if (e.clientX) {
        return e.clientX + (document.documentElement.scrollLeft ?
          document.documentElement.scrollLeft :
          document.body.scrollLeft);
      } else {
        return null;
      }
    }

    function mouseY(e) {
      if (e.pageY) {
        return e.pageY;
      } else if (e.clientY) {
        return e.clientY + (document.documentElement.scrollTop ?
          document.documentElement.scrollTop :
          document.body.scrollTop);
      } else {
        return null;
      }
    }

  </script>
</body>

</html>